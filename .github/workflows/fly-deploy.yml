# Name of the GitHub Actions workflow
name: Fly Deploy Backend

# Controls when the action will run.
# This workflow runs on pushes to the 'main' branch.
on:
  push:
    branches:
      - main

# A workflow run is made up of one or more jobs that can run sequentially or in parallel.
jobs:
  deploy:
    name: Deploy Backend App
    # The type of runner that the job will run on.
    runs-on: ubuntu-latest
    steps:
      # Step 1: Checks-out your repository under $GITHUB_WORKSPACE, so the job can access it.
      - name: Checkout code
        uses: actions/checkout@v4

      # Step 2: Sets up the flyctl CLI tool.
      - name: Set up Fly.io CLI
        uses: superfly/flyctl-actions/setup-flyctl@master

      # Step 3: Deploys the application to Fly.io.
      # It uses a secret called FLY_API_TOKEN for authentication.
      - name: Deploy to Fly.io
        env:
          FLY_API_TOKEN: FlyV1 fm2_lJPECAAAAAAAChO7xBBMKnyAFS9a5tBzCMuFI0ruwrVodHRwczovL2FwaS5mbHkuaW8vdjGUAJLOABNAXh8Lk7lodHRwczovL2FwaS5mbHkuaW8vYWFhL3YxxDxNIfSRSffJ2AhJbX3Ys5l5bSJ9F4bD8DwB68ric+qbOkXtpcdV5lw+P5dBpeZF6jcsz+oZkfb3MWIbDELETgqhu5zSHZtj8q2lkXqWEpSQhMD+es9qRaWN5IvdDUwkteY11NAXu5JuwgYKfcJjY/dNCMPQEkZWaMvn5khIPPbHuYYdIN9wpY0NKKWzoMQgzlikzRdLI1Ly0Pi5jyG8207BIQsdC49Px3nXVi8SVOo=

        run: flyctl deploy --remote-only